import { exec } from "node:child_process";
import { readdir, writeFile } from "node:fs/promises";
import process from "node:process";
import { promisify } from "node:util";

const execAsync = promisify(exec);

async function run() {
  console.log("updating index.ts...");
  let files = await readdir("./src");
  files = files.filter((file) => file.endsWith(".ts") && file !== "index.ts");

  const content = `// This file is auto-generated by scripts/update-index.ts
// Do not edit this file directly.

${files.map((file) => `export * as ${file.replace(".ts", "").replace(".", "_")} from './${file.replace(".ts", "")}';`).join("\n")}
`;

  // update index.ts
  await writeFile("./src/index.ts", content, {
    encoding: "utf-8",
  });

  await execAsync("npx eslint ./src/index.ts --fix");

  console.log("index.ts updated successfully!");
}

run().catch((error) => {
  console.error(error);
  process.exit(1);
});
